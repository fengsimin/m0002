<?php
//Copyright (c) 2016 iFeiwu.com
 class Finder extends Ifeiwu { private $root = "\x64\141\164\141\57\x66\x69\x6e\x64\x65\x72\57"; function __construct() { goto J07oc; vIQtK: $this->table = "\146\151\156\x64\x65\x72"; goto lMYVL; XXE5g: parent::__construct(); goto UdaKb; J07oc: if ($this->table) { goto ipKzC; } goto vIQtK; lMYVL: ipKzC: goto XXE5g; UdaKb: } protected function postAll($pid, $request_data) { goto tNF3G; tNF3G: $files = $this->db->select($this->table)->where($request_data["\x77\150\x65\162\x65"])->order($request_data["\x6f\162\x64\145\162"])->all(); goto y_RmC; qGZ3G: if (!$pid) { goto zYgRt; } goto YXEbr; y_RmC: $paths = array(); goto qGZ3G; DYn6L: $level = array_filter(explode("\x2c", $level)); goto nejOa; i4XYk: zYgRt: goto QcjIg; QcjIg: return array("\146\151\154\145\163" => $files, "\160\x61\164\x68\163" => $paths); goto LVDfV; nejOa: $paths = $this->db->select($this->table, array("\x69\144", "\156\x61\x6d\145"))->where(array("\x69\x64", "\x49\116", $level), "\101\x4e\104", array("\x74\171\160\x65", "\x3d", "\x66\x6f\x6c\144\145\162"))->all(); goto i4XYk; YXEbr: $level = $this->db->select($this->table, "\x6c\145\166\x65\154")->where(array("\x69\144", "\75", $pid))->get(0); goto DYn6L; LVDfV: } protected function postAdd($request_data) { goto GZxld; GM83T: $this->db->rollBack(); goto xH4PZ; B21LP: $filename = $this->_UTF82GBK("\x2e\56\x2f" . $path . $name); goto JoSnH; lVkfO: $level = $this->_getLevel($id); goto fxmJu; g30BZ: $data["\163\151\172\x65"] = $request_data["\x73\x69\x7a\145"]; goto b96Bk; u9kg8: $data["\x70\141\x74\150"] = $path; goto EmuEW; Ea8wz: $type = mime_content_type("\x2e\56\x2f" . $path . $name); goto mA0uM; CaU1K: if ($id = $this->db->insert($this->table, $data)->id()) { goto Wd3KM; } goto u69fa; pKzT7: $this->db->beginTransaction(); goto CaU1K; fLZZL: g3kRF: goto u9kg8; ir6AV: ntl__: goto B21LP; ybDWP: $data["\160\x69\144"] = $foid ? $foid : 0; goto g30BZ; GZxld: $path = $request_data["\x70\141\x74\x68"]; goto elHy6; Sjc7e: if (is_dir($this->_UTF82GBK("\56\56\x2f" . $path))) { goto ntl__; } goto bqjNC; b96Bk: $data["\x63\164\151\x6d\145"] = time(); goto tMvK9; Adk3d: $data["\x74\x79\160\145"] = $type; goto ybDWP; nRsun: $data["\x77\151\144\x74\x68"] = $imagesize[0]; goto Rhk3l; V7aNB: $imagesize = getimagesize($filename); goto nRsun; tMvK9: $data["\145\x78\x74"] = end(explode("\x2e", $name)); goto pKzT7; JoSnH: if (!(stripos($type, "\151\x6d\141\147\145") !== false && is_file($filename))) { goto g3kRF; } goto V7aNB; VTYDA: $this->db->commit(); goto HcQsX; Rhk3l: $data["\150\x65\151\x67\x68\x74"] = $imagesize[1]; goto fLZZL; fxmJu: if (!$this->db->update($this->table, array("\x6c\145\166\145\x6c" => $level), array("\151\144", "\x3d", $id))->is()) { goto Tw4M2; } goto VTYDA; EmuEW: $data["\x6e\141\x6d\145"] = $name; goto Adk3d; mA0uM: $foid = $request_data["\x66\x6f\151\144"]; goto Sjc7e; elHy6: $name = $request_data["\156\x61\155\145"]; goto Ea8wz; IgdIb: SV1WO: goto ir6AV; HcQsX: return $this->success(); goto LdV_V; xH4PZ: return $this->error("\344\270\212\344\xbc\xa0\346\x96\x87\344\273\266\x20" . $name . "\40\345\xa4\xb1\xe8\xb4\245\357\274\201"); goto gDJHo; IlHEH: return $this->error("\345\x88\233\345\273\272\346\x96\207\344\xbb\266\345\xa4\271\345\244\261\350\264\245\357\xbc\x81"); goto IgdIb; qyCby: return $this->error("\344\xb8\212\xe4\274\240\346\x96\x87\xe4\273\266\40" . $name . "\x20\345\244\xb1\350\264\245\357\xbc\x81"); goto aI6Iq; LdV_V: Tw4M2: goto kFxDm; gDJHo: Wd3KM: goto lVkfO; u69fa: unlink($filename); goto GM83T; bqjNC: if (mkdir($this->_UTF82GBK("\56\x2e\x2f" . $path), 511, true)) { goto SV1WO; } goto IlHEH; kFxDm: $this->db->rollBack(); goto qyCby; aI6Iq: } protected function postMkdir($request_data) { goto iYtSW; Y646k: $data["\143\164\151\x6d\145"] = time(); goto NSMUY; NSMUY: if ($id = $this->db->insert($this->table, $data)->id()) { goto fGD6s; } goto J0raD; c_Bgt: $data = array(); goto Hg5PH; Jvapa: $level = array_filter(explode("\54", $level)); goto aPuqA; LOfLL: $name = $request_data["\156\141\155\145"]; goto o5CWM; UgeQK: foreach ($folder as $value) { $folder_path .= $value["\x6e\x61\155\145"] . "\57"; mNeef: } goto OuCE7; qOFEU: if (mkdir($dirname, 493, true)) { goto cExGB; } goto V7r3h; YwTG3: $level = $this->_getLevel($id); goto HMuY6; EFvWZ: owXOd: goto c_Bgt; VB2oV: return $this->error("\345\210\x9b\xe5\273\xba\346\x96\207\xe4\xbb\266\xe5\244\271\345\244\261\350\xb4\245\xef\274\x81"); goto ToKfz; kpHK0: $dirname = $this->_UTF82GBK("\x2e\56\57" . $this->root . $folder_path . $name); goto Nz24V; BjqYI: return $this->error($name . "\x20\xe6\x96\207\xe4\273\266\xe5\244\xb9\345\267\xb2\345\255\x98\345\x9c\xa8\357\274\201"); goto Uh30I; OuCE7: UYvwh: goto opyfM; CrGMs: $folder_path = ''; goto ENkiT; V7r3h: return $this->error("\xe5\x88\x9b\xe5\273\xba\346\226\207\xe4\xbb\266\xe5\244\xb9\345\xa4\xb1\xe8\xb4\245\xef\274\201"); goto KGE7M; Oz6Yz: $data["\164\x79\160\145"] = "\x66\157\154\x64\x65\x72"; goto Y646k; yS3JS: return $this->success(); goto J4icF; opyfM: qhvvj: goto kpHK0; QyE17: $this->db->commit(); goto yS3JS; HMuY6: if ($this->db->update($this->table, array("\x6c\145\x76\x65\154" => $level), array("\151\144", "\75", $id))->is()) { goto yVOT_; } goto WfXM5; Hg5PH: $data["\x6e\141\x6d\145"] = $name; goto CeKzO; J4icF: lDtYa: goto R16HT; q73kP: yVOT_: goto QyE17; dhmi8: return $this->error("\xe5\x88\233\345\xbb\272\xe6\x96\x87\xe4\273\xb6\345\244\xb9\345\244\xb1\xe8\xb4\245\xef\xbc\201"); goto JYHNX; Nz24V: if (!is_dir($dirname)) { goto IVf9l; } goto BjqYI; CeKzO: $data["\x70\151\144"] = $pid; goto CrGMs; WfXM5: rmdir($dirname); goto ezzrM; iYtSW: $pid = $request_data["\160\x69\144"]; goto LOfLL; SpR3T: if (!$level) { goto qhvvj; } goto Jvapa; KGE7M: cExGB: goto gjIAj; gjIAj: $this->db->beginTransaction(); goto EPWVm; ToKfz: fGD6s: goto YwTG3; JYHNX: goto lDtYa; goto q73kP; W3vlW: $data["\163\157\x72\164\142\171"] = 1; goto Oz6Yz; Uh30I: IVf9l: goto qOFEU; ezzrM: $this->db->rollBack(); goto dhmi8; ENkiT: $level = $this->db->select($this->table, "\140\154\x65\166\145\x6c\140")->where(array("\151\144", "\x3d", $pid))->get(0); goto SpR3T; alFkC: return $this->error("\346\227\240\xe6\225\210\xe7\232\x84\xe5\x8f\x82\346\225\260\357\274\x81"); goto EFvWZ; EPWVm: $data["\160\x61\x74\150"] = $this->root . $folder_path; goto W3vlW; aPuqA: $folder = $this->db->select($this->table, "\x60\156\x61\155\x65\x60")->where(array("\151\144", "\111\116", $level), "\x41\116\x44", array("\164\x79\160\145", "\75", "\x66\157\154\x64\x65\x72"))->all(); goto UgeQK; J0raD: rmdir($dirname); goto NON8e; NON8e: $this->db->rollBack(); goto VB2oV; o5CWM: if (!($name === null || $name === '')) { goto owXOd; } goto alFkC; R16HT: } protected function postRename($request_data) { goto Ro_6J; S251Y: if (is_dir($oldname)) { goto hQNfE; } goto YDQbV; MuFzn: goto qGqGX; goto qCD15; AhFbU: return $this->error("\346\226\x87\344\xbb\xb6\345\xa4\271\xe9\207\x8d\xe5\x91\275\xe5\x90\215\345\xa4\xb1\350\264\245\xef\274\201"); goto bxvED; uEsMb: $name = $request_data["\156\x61\155\145"]; goto JQAWx; mMKRi: return $this->success(); goto eiZ5W; GWC3T: $this->db->commit(); goto mMKRi; sx2U7: foreach ($sublist as $sub) { goto GSAt7; R3BGU: lCQlT: goto T_2ye; R2LIW: $level = array_filter(explode("\54", $sub["\154\x65\166\x65\x6c"])); goto HDx3K; u6zLC: goto LxwBl; goto LSPCh; dAW_q: goto z4QFB; goto uzUvJ; nrmNL: LxwBl: goto yNgiD; Zqr9C: $newpath = ''; goto R2LIW; T_2ye: $is_path_update = $this->db->update($this->table, array("\x70\x61\164\150" => $this->root . $newpath), array("\x69\144", "\x3d", $sub["\x69\144"]))->is(); goto melVa; HDx3K: foreach ($level as $lid) { goto Ye8mI; UFAnd: hwMlp: goto Wdpg2; O3yrg: $newpath .= $level_name != '' ? $level_name . "\x2f" : ''; goto UFAnd; hwwlO: VISnz: goto En4BK; bUNbI: goto hwMlp; goto hwwlO; Ye8mI: $levelobj = $this->db->select($this->table, array("\156\141\155\x65", "\154\x65\166\145\x6c"))->where("\x69\x64\40\x3d\x20{$lid}\x20\x41\x4e\x44\x20\x74\x79\160\x65\40\75\x20\x27\x66\157\x6c\144\145\x72\x27")->get(); goto rhbcF; En4BK: $level_name = $levelobj["\x6e\x61\155\x65"]; goto O3yrg; rhbcF: if (!($sub["\164\x79\160\145"] == "\146\x6f\x6c\144\x65\162" && $sub["\x6c\145\166\x65\x6c"] == $levelobj["\x6c\x65\166\145\154"])) { goto VISnz; } goto bUNbI; Wdpg2: } goto R3BGU; LSPCh: Cc4z9: goto Zqr9C; GSAt7: if (!($sub["\154\145\166\x65\154"] == $finder["\x6c\145\166\x65\x6c"])) { goto Cc4z9; } goto u6zLC; uzUvJ: WudIR: goto nrmNL; melVa: if (!($is_path_update === false)) { goto WudIR; } goto dAW_q; yNgiD: } goto gXfEr; xiqcf: k1eMM: goto OgwTl; Y4XK4: nB0Gg: goto RJMG3; lhaY9: hQNfE: goto BVgH5; zCgKu: $this->db->rollBack(); goto PbI2r; Z8UGD: $this->db->rollBack(); goto fdA2y; AEk6S: $this->db->commit(); goto brhdW; LNj30: $finder = $this->db->select($this->table, array("\160\141\164\x68", "\x6e\x61\x6d\145", "\x6c\x65\166\145\x6c"))->where(array("\x69\144", "\75", $id))->get(); goto oH8PI; fdA2y: return $this->error($name . "\40\346\226\207\xe4\xbb\xb6\345\244\271\xe5\xb7\xb2\xe5\xad\230\345\x9c\xa8\xef\xbc\x81"); goto Xe4C1; PbI2r: return $this->error("\346\226\207\xe4\273\266\xe5\xa4\xb9\351\x87\x8d\xe5\x91\275\xe5\x90\215\xe5\244\261\xe8\xb4\xa5\xef\xbc\x81"); goto oAqEn; v85J2: goto oQgd4; goto lhaY9; rPM04: $newname = $this->_UTF82GBK("\56\56\57" . $path . $name); goto GZcFA; odeh9: if ($is_path_update !== false) { goto NtdnO; } goto ybYrr; SwpOQ: if (!(!$path || stripos($path, $this->root) === false)) { goto IP03Z; } goto kJnLL; FKau0: $oldname = $this->_UTF82GBK("\x2e\56\x2f" . $path . $finder["\x6e\141\x6d\145"]); goto rPM04; YSStw: goto oQgd4; goto CfDL_; ftD8b: q331e: goto arQ63; JQAWx: if (!(!$id || $name === null || $name === '')) { goto MAnJf; } goto Qcjix; xKBYb: $this->db->rollBack(); goto RRIEK; Ro_6J: $id = $request_data["\x69\x64"]; goto uEsMb; Xe4C1: goto q331e; goto hIQpY; brhdW: return $this->success(); goto CMAVj; SW46c: NtdnO: goto GWC3T; arQ63: uJTZt: goto CB03C; fYCjQ: $sublist = $this->db->select($this->table, array("\151\144", "\x6c\145\x76\x65\x6c", "\x74\x79\x70\145"))->where(array("\154\x65\x76\145\x6c", "\114\x49\113\105", "\45\x2c{$id}\54\x25"))->all(); goto sx2U7; eiZ5W: UOC5i: goto ftD8b; xUpAT: $this->db->rollBack(); goto AhFbU; oH8PI: $path = $finder["\x70\x61\164\x68"]; goto SwpOQ; Qcjix: return $this->error("\xe6\227\xa0\xe6\225\x88\347\232\204\345\217\202\346\x95\xb0\357\xbc\201"); goto keqAe; CB03C: oQgd4: goto z85nD; gtcrU: IP03Z: goto FKau0; hIQpY: CCG6V: goto fYCjQ; BVgH5: if ($this->db->update($this->table, array("\156\x61\x6d\x65" => $name), array("\x69\144", "\75", $id))->is()) { goto nB0Gg; } goto xUpAT; f_wFl: $this->db->rollBack(); goto rl5Re; kJnLL: return $this->error("\346\227\240\346\x95\x88\xe7\x9a\x84\xe8\267\xaf\xe5\xbe\x84\xef\xbc\201"); goto gtcrU; ybYrr: rename($newname, $oldname); goto zCgKu; RRIEK: return $this->error("\346\x96\207\xe4\273\266\351\x87\x8d\xe5\221\xbd\345\220\215\345\xa4\xb1\xe8\xb4\245\xef\xbc\201"); goto J4hi9; qCD15: EHrqw: goto AEk6S; OgwTl: if (rename($oldname, $newname)) { goto EHrqw; } goto f_wFl; CMAVj: qGqGX: goto nG4Bn; bxvED: goto uJTZt; goto Y4XK4; rl5Re: return $this->error("\346\226\x87\344\xbb\xb6\xe9\x87\x8d\345\x91\xbd\345\220\215\xe5\244\261\350\xb4\245\357\xbc\x81"); goto MuFzn; keqAe: MAnJf: goto LNj30; GZcFA: $this->db->beginTransaction(); goto jdfuf; nG4Bn: g6_4D: goto v85J2; J4hi9: goto g6_4D; goto xiqcf; oAqEn: goto UOC5i; goto SW46c; RJMG3: if (rename($oldname, $newname)) { goto CCG6V; } goto Z8UGD; wWNip: if ($this->db->update($this->table, array("\x6e\141\155\145" => $name), array("\151\144", "\75", $id))->is()) { goto k1eMM; } goto xKBYb; jdfuf: if (is_file($oldname)) { goto Q6lPN; } goto S251Y; CfDL_: Q6lPN: goto wWNip; YDQbV: return $this->error("\346\x89\276\344\xb8\215\xe5\x88\260\xe9\x87\215\xe5\221\275\xe5\x90\215\xe7\232\204\xe6\226\207\xe4\xbb\266\57\346\226\207\344\xbb\xb6\xe5\xa4\xb9\357\xbc\201"); goto YSStw; gXfEr: z4QFB: goto odeh9; z85nD: } protected function postIsFile($request_data) { goto pDcDx; pDcDx: $path = $request_data["\x70\141\x74\x68"]; goto L0Nat; jsqXe: return $this->success($name . "\x20\346\226\x87\xe4\xbb\266\345\xb7\xb2\xe5\xad\230\xe5\234\xa8\xef\xbc\201"); goto fltns; ClPAt: return $this->error($name . "\x20\xe6\x96\207\344\273\266\344\xb8\215\xe5\255\230\345\234\250\xef\274\x81"); goto jBilk; L0Nat: $name = $request_data["\x6e\x61\x6d\x65"]; goto v7hv5; fltns: iuYJ4: goto g_PJd; YwHZA: cnRpm: goto jsqXe; v7hv5: if (file_exists($this->_UTF82GBK("\56\x2e\57" . $path . $name))) { goto cnRpm; } goto ClPAt; jBilk: goto iuYJ4; goto YwHZA; g_PJd: } protected function postDelete($request_data) { goto BpI9z; CA4iX: return $this->success(); goto rcp2R; BpI9z: $ids = $request_data["\x69\x64"]; goto V4MAG; V4MAG: foreach ($ids as $id) { goto IaV_8; IaV_8: $file = $this->db->select($this->table, array("\x70\141\164\x68", "\156\x61\155\145"))->where(array("\x69\144", "\75", $id))->get(); goto HMGsF; tTlm5: goto uecsl; goto Cumqg; iKlek: if (!$this->db->delete($this->table, array("\x69\x64", "\x3d", $id))->is()) { goto vmY4Q; } goto qtxIp; fE3cm: $this->db->delete($this->table, array("\154\x65\x76\145\x6c", "\114\x49\113\x45", "\x25\54{$id}\x2c\45")); goto tTlm5; vLyk9: if (!$this->db->delete($this->table, array("\x6c\145\166\x65\x6c", "\x4c\111\x4b\105", "\x25\54{$id}\x2c\x25"))->is()) { goto W0I_2; } goto dZlIM; Cumqg: KutJJ: goto iKlek; nW1bu: goto uecsl; goto ki5A_; La90s: $this->db->delete($this->table, array("\x69\144", "\75", $id))->is(); goto FyQs7; ki5A_: CXLwV: goto vLyk9; KoTM4: if (is_dir($filename)) { goto CXLwV; } goto fE3cm; HMGsF: if ($file) { goto KMxJF; } goto vlXqB; HSmPP: KMxJF: goto ODJY_; ODJY_: $path = $file["\x70\x61\x74\150"]; goto OJQiv; uoD6I: $filename = $this->_UTF82GBK("\x2e\x2e\57" . $path . $name); goto jkgj_; YHwj0: DQmvo: goto tojDr; k3kbs: uecsl: goto YHwj0; g7iny: W0I_2: goto k3kbs; tvmyK: F94Qe: goto uoD6I; OJQiv: $name = $file["\x6e\x61\155\145"]; goto UmQIV; jkgj_: if (is_file($filename)) { goto KutJJ; } goto KoTM4; dZlIM: $this->_rmdir($filename); goto g7iny; FyQs7: goto DQmvo; goto tvmyK; UmQIV: if (!(!$path || stripos($path, "\x64\x61\x74\x61\x2f\146\151\156\x64\x65\162\57") === false || $name == null || $name == '')) { goto F94Qe; } goto La90s; UYoao: vmY4Q: goto nW1bu; vlXqB: goto DQmvo; goto HSmPP; qtxIp: @unlink($filename); goto UYoao; tojDr: } goto eqOpT; eqOpT: OocZ_: goto CA4iX; rcp2R: } protected function getCurPath($foid) { goto T0TaK; q6fdw: return $this->success('', $data); goto KDCxn; o2r5j: $data = $this->db->select($this->table, array("\x69\x64", "\156\x61\155\x65"))->where(array(array("\x69\x64", "\111\x4e", $level), "\x41\x4e\104", array("\164\171\160\x65", "\75", "\x66\x6f\154\144\145\x72")))->all(); goto q6fdw; T0TaK: $level = $this->db->select($this->table, "\154\145\x76\x65\x6c")->where(array("\x69\x64", "\x3d", $foid))->get(0); goto oitMy; oitMy: $level = array_filter(explode("\54", $level)); goto o2r5j; KDCxn: } }
