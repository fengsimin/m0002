<?php
//Copyright (c) 2016 iFeiwu.com
 class Uploader extends Ifeiwu { function __construct() { } protected function postImage($request_data) { goto pOFBz; VruPl: $handle->file_new_name_body = $file_new_name_body; goto VeKu2; ukI6k: return $this->success('', array("\x70\141\164\150" => $file_save_path, "\151\x6d\x61\x67\x65" => $handle->file_dst_name, "\163\151\172\145" => $handle->file_src_size, "\167\151\x64\164\x68" => $handle->image_src_x, "\x68\x65\x69\147\150\x74" => $handle->image_src_y, "\x74\x79\x70\145" => $handle->image_dst_type, "\x65\x78\x74" => $handle->file_dst_name_ext)); goto H1VbY; o5KYZ: $image_convert = $_POST["\x69\x6d\x61\147\145\137\143\x6f\x6e\166\x65\162\164"]; goto GvmdV; N0NDy: z5l46: goto xAobM; OrMkR: if (!empty($_FILES["\146\x69\x6c\x65"])) { goto z5l46; } goto sWaLN; YEWWm: $image_x = explode("\x2c", $_POST["\151\155\x61\147\x65\137\170"]); goto wx3o0; GoQOg: mPdoN: goto Tiomn; ScPJp: buoyT: goto G2koV; xAobM: ifeiwu\Loader::import("\145\x78\x74\145\156\x64\x2f\x55\160\154\x6f\141\x64"); goto vJp0f; UNoXw: x9afE: goto GoQOg; rjNMl: $file_save_path = ''; goto d3Jc0; GvmdV: $jpeg_quality = explode("\54", $_POST["\x6a\160\145\147\137\x71\x75\141\154\151\164\x79"]); goto bgHii; nE_iu: goto da0tD; goto zixyJ; bgHii: if ($image_resize == 1) { goto QbL4e; } goto VZzkY; yfNUj: $image_resize = $_POST["\151\x6d\141\x67\x65\137\162\145\163\x69\172\145"]; goto Fo5yv; vJp0f: $handle = new Upload($_FILES["\146\x69\154\145"]); goto Ip2e4; tYCuA: $handle->Process($upload_root . "\57" . $file_save_path); goto i_CIy; o6UOu: $_FILES["\x66\x69\x6c\x65"]["\163\151\x7a\145"] = $_POST["\146\151\154\145\x5f\163\151\x7a\x65"]; goto Sswde; lF3V1: $file_name_body_pre = explode("\x2c", $_POST["\146\x69\154\x65\x5f\156\x61\x6d\x65\137\142\157\x64\171\x5f\x70\x72\x65"]); goto YEWWm; ob81D: $handle->image_convert = $image_convert; goto FdF0X; qQpPc: if (!$quality) { goto jnPPW; } goto MVBnv; FdF0X: sYQgb: goto DEdDN; Tiomn: if ($handle->processed) { goto wijC0; } goto v0tfK; pOFBz: $_FILES["\x66\x69\x6c\145"]["\x6e\141\x6d\x65"] = $_POST["\146\151\154\x65\137\x6e\x61\155\145"]; goto BGHA8; VeKu2: b6vX_: goto s3wSH; uq6bh: jnPPW: goto jTwFu; VZzkY: $quality = end($jpeg_quality); goto qQpPc; wx3o0: $image_y = explode("\54", $_POST["\x69\155\141\147\145\137\171"]); goto XaU3z; Ip2e4: if (!$handle->uploaded) { goto mPdoN; } goto hJH1x; zixyJ: wijC0: goto OS_Q9; XaU3z: foreach ($file_name_body_pre as $key => $prefix) { goto tlxeG; b_wqh: $handle->file_name_body_pre = $prefix; goto yaRcq; iKsqA: ZkYJr: goto F1pGJ; xMGZf: $handle->image_y = $height; goto iTtKq; Sodu_: $handle->image_resize = $image_resize ? true : false; goto b_wqh; uOR6p: goto mvr0g; goto plI0B; grE70: dXI6D: goto Q2wK_; FufOy: if ($height && $handle->image_src_y > $height) { goto ZkJsq; } goto hTpJB; xAyvH: $handle->file_new_name_body = $file_new_name_body; goto MqO8N; Ym8pd: if ($width && $handle->image_src_x > $width) { goto ZkYJr; } goto gKgvw; NBplk: if (!$prefix) { goto ZZWBB; } goto Sodu_; uHCBa: $handle->Process($upload_root . "\57" . $file_save_path); goto vxHeA; vxHeA: Jf9m8: goto FOxhe; Jccp9: goto oq91u; goto iKsqA; iTtKq: mvr0g: goto cuPui; tlxeG: $width = $image_x[$key]; goto UCHkW; OOmIB: $handle->image_convert = $image_convert; goto nGptB; cuPui: if (!$file_new_name_body) { goto Kb60o; } goto xAyvH; MqO8N: Kb60o: goto LdVhV; Q2wK_: if (!$image_convert) { goto jIrQB; } goto OOmIB; plI0B: ZkJsq: goto xMGZf; VgdsD: $handle->jpeg_quality = $quality; goto grE70; gKgvw: $handle->image_x = $handle->image_src_x; goto Jccp9; UCHkW: $height = $image_y[$key]; goto VwCyx; VwCyx: $quality = $jpeg_quality[$key]; goto NBplk; bUKcr: if (!$quality) { goto dXI6D; } goto VgdsD; LdVhV: $handle->file_overwrite = $file_overwrite ? true : false; goto uHCBa; hTpJB: $handle->image_ratio_y = true; goto uOR6p; nGptB: jIrQB: goto Ym8pd; F1pGJ: $handle->image_x = $width; goto r1zGt; yaRcq: ZZWBB: goto bUKcr; r1zGt: oq91u: goto FufOy; FOxhe: } goto ng_f1; d3Jc0: vYtBM: goto ukI6k; sWaLN: return $this->error("\346\x97\xa0\346\x95\210\347\x9a\204\xe6\226\x87\xe4\273\266\xe4\277\xa1\xe6\201\xaf\357\xbc\x81"); goto QVJeb; OS_Q9: if (!($file_save_path == "\57")) { goto vYtBM; } goto rjNMl; Yei1k: $file_overwrite = $_POST["\x66\x69\x6c\145\137\157\166\145\162\167\x72\x69\x74\x65"]; goto yfNUj; MVBnv: $handle->jpeg_quality = $quality; goto uq6bh; Sswde: $_FILES["\146\x69\x6c\145"]["\x65\x72\162\157\x72"] = $_POST["\146\x69\x6c\145\x5f\145\x72\x72\157\162"]; goto OrMkR; jTwFu: if (!$image_convert) { goto sYQgb; } goto ob81D; H1VbY: da0tD: goto ScPJp; i_CIy: goto x9afE; goto m1J7U; s3wSH: $handle->file_overwrite = $file_overwrite ? true : false; goto tYCuA; YzbkX: $file_new_name_body = $_POST["\x66\x69\x6c\145\137\x6e\x65\x77\x5f\156\141\155\x65\x5f\x62\157\x64\171"]; goto Yei1k; hJH1x: $upload_root = "\x2e\56\57"; goto YzbkX; Fo5yv: $file_save_path = $_POST["\146\151\154\145\137\x73\141\166\x65\x5f\160\141\164\150"]; goto o5KYZ; DEdDN: if (!$file_new_name_body) { goto b6vX_; } goto VruPl; ng_f1: eRQWd: goto UNoXw; BGHA8: $_FILES["\146\x69\x6c\x65"]["\164\x79\x70\145"] = $_POST["\x66\x69\x6c\x65\x5f\164\171\160\x65"]; goto o6UOu; m1J7U: QbL4e: goto lF3V1; QVJeb: goto buoyT; goto N0NDy; v0tfK: return $this->error($handle->log); goto nE_iu; G2koV: } protected function postFile($request_data) { goto Fj5JR; qKMBj: mkdir($temp_dir, 511, true); goto Ic46e; IT9gg: $this->_debug("\105\x72\x72\157\x72\x20\163\141\166\x69\156\147\40\x28\x6d\x6f\x76\x65\137\165\160\x6c\x6f\141\144\145\144\x5f\146\151\x6c\145\x29\x20\x63\150\165\156\153\40" . $resumableChunkNumber . "\x20\x66\157\x72\x20\146\151\154\x65\40" . $resumableFilename); goto kEFv9; I6HMu: $this->_debug("\x65\162\x72\x6f\x72\x20" . $file["\x65\162\162\157\162"] . "\x20\151\x6e\40\x66\151\154\x65\40" . $resumableFilename); goto sikuY; A5Ude: $resumableChunkNumber = $_POST["\162\x65\163\165\155\x61\142\154\x65\x43\x68\x75\x6e\x6b\116\165\x6d\142\x65\162"]; goto zx_ns; Fj5JR: $save_path = "\x2e\x2e\57" . $this->_UTF82GBK($_POST["\163\141\166\x65\x5f\160\141\164\150"]); goto Gjm0p; S9gTq: $_FILES["\x66\151\x6c\x65"]["\163\x69\x7a\145"] = $_POST["\x66\151\x6c\x65\x5f\x73\x69\172\x65"]; goto x6w1l; lN7DX: $file = $_FILES["\x66\x69\x6c\x65"]; goto mDtrN; b3IZe: $_FILES["\x66\x69\154\x65"]["\156\141\155\x65"] = $_POST["\x66\151\154\x65\x5f\156\x61\x6d\145"]; goto wyez4; KGJ3U: goto CPyVJ; goto qnAZu; mDWAc: $this->_createFileFromChunks($save_path, $temp_dir, $resumableFilename, $_POST["\x72\x65\x73\165\155\x61\142\154\145\103\x68\x75\156\153\x53\x69\x7a\x65"], $_POST["\162\145\x73\x75\155\141\142\x6c\x65\124\157\164\x61\154\123\151\172\145"]); goto KGJ3U; mDtrN: if (!($file["\145\x72\162\157\162"] != 0)) { goto a5lal; } goto I6HMu; yQJ3A: if (!move_uploaded_file($file["\164\x6d\x70\137\156\141\x6d\145"], $dest_file)) { goto cOmxU; } goto mDWAc; CdtpZ: $temp_dir = $save_path . "\x2f" . $resumableIdentifier; goto iM03u; sikuY: a5lal: goto CdtpZ; zx_ns: $resumableIdentifier = $_POST["\x72\x65\x73\x75\x6d\141\x62\154\x65\111\144\x65\x6e\x74\151\x66\x69\145\x72"]; goto b3IZe; Ic46e: Emaxe: goto yQJ3A; lpc9P: if (is_dir($temp_dir)) { goto Emaxe; } goto qKMBj; kEFv9: CPyVJ: goto jOQ_1; Gjm0p: $resumableFilename = $this->_UTF82GBK($_POST["\x72\x65\163\165\x6d\x61\142\154\145\x46\x69\x6c\x65\156\x61\155\x65"]); goto A5Ude; iM03u: $dest_file = $temp_dir . "\x2f" . $resumableFilename . "\56\x70\141\162\164" . $resumableChunkNumber; goto lpc9P; qnAZu: cOmxU: goto IT9gg; wyez4: $_FILES["\x66\x69\x6c\x65"]["\164\x79\160\145"] = $_POST["\146\151\x6c\x65\137\164\171\160\x65"]; goto S9gTq; x6w1l: $_FILES["\146\151\154\145"]["\x65\162\162\157\x72"] = $_POST["\x66\x69\154\145\137\x65\x72\x72\x6f\x72"]; goto lN7DX; jOQ_1: } protected function getFile() { goto jyM6x; K4kzY: $chunk_file = $temp_dir . "\57" . $resumableFilename . "\56\160\141\162\x74" . $resumableChunkNumber; goto BirhK; BirhK: if (file_exists($chunk_file)) { goto a883S; } goto PXX7B; PXX7B: return 404; goto wtSc0; mlmq4: return 202; goto bTwmw; tWASR: $temp_dir = $save_path . "\57" . $resumableIdentifier; goto K4kzY; wtSc0: goto ffcyo; goto Ffzs9; Ffzs9: a883S: goto mlmq4; kctOD: $resumableIdentifier = $_GET["\162\145\163\165\x6d\x61\x62\154\145\x49\144\x65\x6e\x74\x69\x66\x69\145\162"]; goto tWASR; bTwmw: ffcyo: goto s2ISK; jyM6x: $save_path = "\x2e\x2e\x2f" . $this->_UTF82GBK($_GET["\x73\x61\166\145\137\x70\x61\164\150"]); goto ZMMzG; n8nxV: $resumableChunkNumber = $_GET["\x72\x65\163\x75\x6d\141\x62\x6c\x65\103\150\165\x6e\153\x4e\x75\x6d\x62\x65\162"]; goto kctOD; ZMMzG: $resumableFilename = $this->_UTF82GBK($_GET["\x72\145\x73\x75\155\x61\142\x6c\145\106\151\154\x65\x6e\x61\x6d\145"]); goto n8nxV; s2ISK: } private function _createFileFromChunks($save_path, $temp_dir, $fileName, $chunkSize, $totalSize) { goto qtkj8; bzox2: R_MTC: goto RfgUY; sqfwN: goto exzJa; goto m7N_r; n4zET: $this->_rrmdir($temp_dir); goto dTMBT; HTKac: $i++; goto gKPtF; d3wSA: oHl3C: goto Q5yPe; LJVJn: if (rename($temp_dir, $temp_dir . "\x5f\x55\116\x55\x53\105\104")) { goto oHl3C; } goto n4zET; qu3nW: Vyp9c: goto PEIlr; BtggB: if (!($total_files * $chunkSize >= $totalSize - $chunkSize + 1)) { goto Vyp9c; } goto eMjhL; eMjhL: if (($fp = fopen($save_path . "\57" . $fileName, "\x77")) !== false) { goto SVhvi; } goto qVgqW; RPuDI: cGfrn: goto BtggB; LFHrQ: if (!($i <= $total_files)) { goto R_MTC; } goto EEz_y; dA7Rx: J9MEB: goto qu3nW; BMxns: ag6Tb: goto HTKac; qVgqW: $this->_debug("\x63\x61\x6e\x6e\157\164\40\143\x72\x65\x61\x74\x65\40\164\x68\145\x20\144\x65\163\x74\151\x6e\x61\164\151\157\x6e\40\x66\151\x6c\x65"); goto pDs_N; nVvbc: $i = 1; goto SaFlN; EEz_y: fwrite($fp, file_get_contents($temp_dir . "\57" . $fileName . "\x2e\x70\x61\x72\x74" . $i)); goto BMxns; Q5yPe: $this->_rrmdir($temp_dir . "\x5f\x55\x4e\x55\123\105\104"); goto dA7Rx; m7N_r: SVhvi: goto nVvbc; pDs_N: return false; goto sqfwN; gKPtF: goto eC1wy; goto bzox2; SaFlN: eC1wy: goto LFHrQ; qtkj8: $total_files = 0; goto uZEG3; uZEG3: foreach (scandir($temp_dir) as $file) { goto zEkj3; coY05: JGvmD: goto Nz6qT; HAW8P: A5YOq: goto coY05; zEkj3: if (!(stripos($file, $fileName) !== false)) { goto A5YOq; } goto fcVUC; fcVUC: $total_files++; goto HAW8P; Nz6qT: } goto RPuDI; Vrsb5: exzJa: goto LJVJn; dTMBT: goto J9MEB; goto d3wSA; RfgUY: fclose($fp); goto Vrsb5; PEIlr: } private function _rrmdir($dir) { goto crsxe; dr_SD: reset($objects); goto aqFDy; YBnVz: foreach ($objects as $object) { goto DVfdm; n7nkf: ZozzU: goto Uc15T; UlyLy: unlink($dir . "\x2f" . $object); goto sDODF; Uc15T: vMynz: goto Dt9wd; X_Xqm: d8LKY: goto fY8Jn; d33_D: c_Z62: goto n7nkf; fY8Jn: $this->_rrmdir($dir . "\x2f" . $object); goto d33_D; DVfdm: if (!($object != "\x2e" && $object != "\x2e\56")) { goto ZozzU; } goto On7Iq; On7Iq: if (filetype($dir . "\57" . $object) == "\144\x69\162") { goto d8LKY; } goto UlyLy; sDODF: goto c_Z62; goto X_Xqm; Dt9wd: } goto IDuk4; aqFDy: rmdir($dir); goto dHVwF; dHVwF: CHHXv: goto k7kWo; uIoOs: $objects = scandir($dir); goto YBnVz; IDuk4: jKnJj: goto dr_SD; crsxe: if (!is_dir($dir)) { goto CHHXv; } goto uIoOs; k7kWo: } }
